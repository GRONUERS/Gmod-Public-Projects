# Mesh Loader 사용 설명서

1. StarfallEx

   * 칩의 경로
   
2. 기본 칩 설정

   * 수정 가능한 것과 가능하지 않은 것
   
3. 메쉬 파일 기본 설정

4. 메쉬 불러오기

5. 커스텀 재질 / 데칼 적용하기

6. 다른 차량 또한 소환 하기

7. 글을 마치며


### 유의 할 점 : 스타폴을 매번 최신 버전으로 업데이트 해주시길 바랍니다, 오류가 날 수도 있습니다. (코드를 마지막 업데이트를 기준으로 짜기 때문)

# StarfallEx
먼저 이 칩을 사용하기 위해선 Wire가 아닌 Github에서 StarfallEx (thrgrb)버전을 받아야 합니다.
https://github.com/thegrb93/StarfallEx

다운로드를 받은 후에는 Garrysmod\garrysmod\addons 에 복사 및 붙여넣기를 하시면 성공적으로 적용이 됩니다.

그리고 기본적으로 콘솔창에 입력해야할 코드들이 있습니다.
```lua
sf_mesh_triangles_max_cl 2000000 -- 메쉬의 트라이앵글 제한을 늘려줍니다 (기본 200000)
sf_timebuffer_cl 15 -- 연산량 제한을 높혀줍니다.
sf_timebuffer_cl_owner 15 -- 연산량 제한을 높혀줍니다.
```

 ##	칩의 경로
 모든 스타폴의 칩은 Garrysmod\garrysmod\data\starfall 의 경로에 저장되어집니다.
 이 경로에 Mesh_Loader.txt 와 Mesh_Default_Settings.txt 를 넣어주시면 됩니다.

이 모든것들을 다 하셨다면 모든 준비가 끝난 것입니다.

# 기본 칩 설정

## 수정 가능한 것과 가능하지 않은 것
``` 일단 기본적으로 Mesh_Loader.txt의 내용은 절대로 건드시면 안됩니다. ```

Mesh_Default_Settings.txt의 내용은

![](https://dl.dropbox.com/s/00q5g2o3qbdycfp/Default%20Settings.png)

이런식으로 구성이 되어있는데

여기서 수정 가능한 구문은


```lua
local name = "" --칩의 이름을 정해줍니다.
local meshdelay = 4 --메쉬 소환 딜레이를 정합니다. (3.5 미만으로는 추천드리지 않습니다.)
local meshSpeed = 7 --메쉬의 로딩 시간을 정합니다. (높을수록 로딩시간이 길어집니다. 하지만 그만큼 서버의 부하도 줄어듭니다. 100~10000)

["HudStatus"] = true / false,
--오른쪽 밑에 렌더링 할 메쉬가 몇개 남았는지를 띄워줍니다. (젤렌서버에선 enableHud가 구문이 없으므로, false로 미리 설정해두시기 바랍니다.)

["Scale"] = Number
--메쉬의 전체 크기를 정합니다.

["URL"] = {"dropbox format"}
--메쉬의 URL을 적어줍시다.

["Color"] = {"R G B A"}
--색상을 정해줍니다. (string 포맷으로 "R G B A" 그대로 적어주셔야 합니다. A는 Alpha (투명도) 이므로 0~255 크면 클수록 불투명해집니다.)
--똑같은 색상을 반복하려면 행 바꿈을 한 뒤, 색상값 대신 반복할 횟수를 string 포맷으로 정해줍니다. 예) "4" = 이전에 쓴 색상을 4번 반복

["Material"] = {"models/debug/debugwhite" / "custom 'dropbox material'"}
--재질을 정해줍니다. (string 포맷으로 "재질"을 적어줍니다.)
--(똑같은 색상을 반복하려면 행 바꿈을 한 뒤, 재질 대신 반복할 횟수를 string 포맷으로 정해줍니다. 예) "4" = 이전에 쓴 재질을 4번 반복)

["Parent"] = { [Index] = {"패런트 지정 타겟","지정 타겟의 부모"} }
--이번에 새롭게 추가된 기능 입니다. [Index] 부분에 몇번째 홀로그램을 지정된 지정 타겟, 타겟의 부모로 패런할지 정합니다.
--(지정 타겟의 이름은 Dropbox에서 설정했던 이름 그대로 따라갑니다.) 예시) [1] = {"Body 1","Move"}

```

입니다.

# 메쉬 파일 기본 설정

Visual Studio Code를 기준으로 설명드리겠습니다.

일단 내보내기 할때 저희는 페이스 개수를 많이 보게 되는데, 평균적으로는 2만개 이하 정도면은 불러올수 있습니다. 정확한건 총 OBJ 파일 행의 갯수가 65535줄을 넘으면 안되는 것이고, 
6만줄 이상부터는 몇몇 트라이앵글이 깨질수 가 있다는 것을 유의해두시길 바랍니다.

** 유의 할점 !!! 다중선택을 해서 내보내기를 할땐, 선택을 하고 합치기 (Join)을 한 후에 내보내기를 해야 합니다.)
일단 처음에 내보내기를 하면

![](https://note.nulltable.xyz/uploads/upload_04d00c8b9bf3f1837195f5d790e2631a.png)

이런식으로 뜰껀데, 저희는 mtl (material)파일은 필요없으니 지울겁니다.

obj파일을 메모장 / 노트패드 / VSC 등으로 열게 되면
![](https://note.nulltable.xyz/uploads/upload_0239006fd496231ef4e22ec06b6a08c6.png)
이런식으로 뜨게 될것입니다.

여기서 저희가 기본적으로 바꿔줘야 할것은 o 뒤에있는 것인데요. 저희는 스타폴로 불러올 모든 obj파일을 o Draw로 바꿔줄것입니다.
그리고 그 위에 있는 mtllib... 또한 지워줄것입니다.

![](https://note.nulltable.xyz/uploads/upload_482a929dcf7fe15231122984ead05d51.png)

('Functions.blend'에 써져있는건 다 다릅니다. 굳이 똑같이 Functions.blend 로 바꿀 필요가 없습니다.)
그러면 최종적으론 이런식으로 밖에 남아있지 않을 것입니다. ('Functions.blend'에 써져있는건 다 다릅니다. 굳이 똑같이 Functions.blend 로 바꿀 필요가 없습니다.)

그럼 이제 저희는 l의 글자를 포함하는 모든 글자를 찾아서 지워낼것입니다.

모든 프로그램엔 Ctrl + F를 누르면 행 찾기가 있으니 그걸 이용해서 찾고 지워주도록 합시다.
찾기를 하여 l을 포함한 모든 글자를 다 지워줍시다. 예외적으로 ```l 123 200``` 이런식으로 나오는
경우도 있는데, 이것은 ```무조건 지워줘야 합니다. 지우지 않으면 에러가 나버립니다.```

그럼 이제 저장을 해주고, https://dropbox.com 에 올려주시면 됩니다. 저는 개인적으로 폴더를 만들고 그 안에 저장을 하는것을 추천 드립니다.

# 메쉬 불러오기

스타폴의 mesh_default_settings.txt 탭에 들어가서, ```["URL"] = {}``` 안에 URL들을
추가 시킬겁니다.
Dropbox에서 아까 올린 파일의 링크를 복사후에, 붙여넣기 해서 사용해줍니다. (링크를 수동적으로 바꾸지 않아도 자동적으로 변환 해서 인식합니다.)

이 링크를 URL에 붙여넣기 하고, Ctrl + S (저장)을 한 후에, Mesh_Loader를 소환해주시면
정상적으로 로딩이 되실겁니다.

# 커스텀 재질 / 데칼 적용하기

비행기나 레이스 차량같은 경우엔 데칼 같은경우가 심어져 있는게 대부분 입니다.
하지만 P2M에선 불가능하다는것을 알아버렸죠. 하지만, 스타폴은 모든게 가능합니다.

그저 몇가지를 추가 하면 됩니다.

일단 Mesh_Default_Settings.txt 에서 ```["Material"] = {}``` 부분에 ```{"custom Dropbox재질"}``` 라고 적어줍시다
(이 Dropbox재질 또한 수동적으로 링크를 변환 하지 않아도, 자동적으로 변환하여 적용시킵니다.)

**(사진 크기는 최소 512x512, 최대 1024x1024) 1024x1024를 추천드립니다.**

# 다른 차량 또한 소환 하기

저희가 뭐 한 차량만 파서 빌드하는것도 아니고, 여러개를 만드는 경우가 대부분일것입니다.

하지만 저는 세팅을 딱 한대만 할수 있게 간편하게 만들어놨기 때문에 여러대를 불러오지 못합니다. 하지만 몇개만 바꾸면 여러대를 불러올 수 있을것입니다.


일단 mesh_defualt_settings 의 이름을 바꿔줄겁니다. 자신이 원하는 것으로 바꿔주는데, `` 이때 ```Ctrl + S```를 누르면 절대 안됩니다. ``

![image](https://user-images.githubusercontent.com/75050481/120856278-8f146700-c5ba-11eb-8339-96eff19e247e.png)

사진에 표기된 UI 버튼을 눌러주어서 다른 이름으로 저장을 해줍니다.

그 다음에 Mesh_Loader 에 다시 들어가준 다음에 
```lua 
--@include mesh_default_settings.txt 
Settings = require("mesh_default_settings.txt")
```
이 둘의 mesh_default_settings를 자신이 바꿔준 이름으로 바꿔줍니다.

만약 ASDF로 변경을 하였다면, 
```lua
--@include ASDF.txt
Settings = require("ASDF.txt")
```
가 되겠죠.

그런 다음에 다시 다른 이름으로 저장을 눌러줍시다.

그러면 에디터창이 좀 더러워지긴 해도, 여러대의 차량을 불러오실수 있을것입니다.

# 글을 마치며

사실은 고민을 많이 했습니다. 이걸 나만 써야 하는걸까, 나 말고 다른 사람이 써보면 어떨까.
몇몇 친분이 있는 분들에게만 알려드리기엔 또 너무 차별 같아서, 결국엔 직접적으로 최대한 만드는 분들의 편의를 신경써서 칩을 구상해보았습니다. 제가 항상 이 칩을 공개해야겠다는 생각이 들기전까진 지인들에겐 "예제 응용" 이라는 말을 남겼는데, 이 칩들 또한, 오로지 예제응용으로 구성된 칩들 입니다.
사실 저도 이 스타폴 메쉬를 쓸 줄은 몰랐지만 직접 예제에 있는 드롭박스 링크에 들어가 보면서 내가 블렌더에서 내보내기 한것과는 뭐가 다른게 있는지 구분해가면서 찾아냈습니다.
이 칩을 공개해야겠다는 생각이 든 이유는, 메쉬에 대해 꺠닫게 해준 기계식흑설탕님 덕분인데 처음에 그분이 Prop2Mesh와 Sketchfab 다운로더를 선사시키지 않았다면 저희는 여전히 프롭으로 빌드를 해갔었겠죠. 
저는 이 칩으로 인해, 사람들의 모델 퀄리티가 더 높아지기를 기원 하겠습니다.

궁금하신 점이나 막힌곳 또는 버그를 찾으셨다면, GRONUERS#1231 로 직접적으로 DM을 보내주시면 알려드리겠습니다.

> **마지막으로 긴 글을 읽어주셔서 감사하고 좋은 ~~불러오기~~ 만들기 하세요 !**
